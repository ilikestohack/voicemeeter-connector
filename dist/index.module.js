import n from"koffi";import t from"winreg";var e,r,u=function(n){try{var t=function(){return o(n,e)},e=[].slice.call(arguments,1);if(!n.isConnected)throw new Error("Not connected ");var r=e[e.length-1];e.pop();var u=function(){if(void 0!==r)return Promise.resolve(n.setOption(e.join(".")+"="+r)).then(function(){})}();return Promise.resolve(u&&u.then?u.then(t):t())}catch(n){return Promise.reject(n)}},o=function(n,t){try{return Promise.resolve(n.getOption(t.join(".")))}catch(n){return Promise.reject(n)}},i=/*#__PURE__*/function(){function o(){var n,t=this;this.isConnected=!1,this.isInitialised=!1,this.outputDevices=[],this.inputDevices=[],this.version="",this.type=void 0,this.eventPool=[],this.stringParameters=["Label","FadeTo","FadeBy","AppGain","AppMute","name","ip"],this.connect=function(){if(!t.isInitialised)throw new Error("Await the initialisation before connect");if(!t.isConnected){if(0===e.VBVMR_Login())return t.isConnected=!0,t.type=t.getVoicemeeterType(),t.version=t.getVoicemeeterVersion(),void setInterval(t.checkPropertyChange,10);throw t.isConnected=!1,new Error("Connection failed")}},this.disconnect=function(){if(!t.isConnected)throw new Error("Not connected ");try{if(0===e.VBVMR_Logout())return void(t.isConnected=!1);throw new Error("Disconnect failed")}catch(n){throw new Error("Disconnect failed")}},this.updateDeviceList=function(){if(!t.isConnected)throw new Error("Not connected ");t.outputDevices=[],t.inputDevices=[];for(var n=e.VBVMR_Output_GetDeviceNumber(),r=0;r<n;r++){var u=Buffer.alloc(256),o=Buffer.alloc(256),i=[0];e.VBVMR_Output_GetDeviceDescA(r,i,o,u),t.outputDevices.push({name:o.toString().replace(/\u0000+$/g,""),hardwareId:u.toString().replace(/\u0000+$/g,""),type:i[0]})}for(var c=e.VBVMR_Input_GetDeviceNumber(),a=0;a<c;a++){var f=Buffer.alloc(256),s=Buffer.alloc(256),l=[0];e.VBVMR_Input_GetDeviceDescA(a,l,s,f),t.inputDevices.push({name:s.toString().replace(/\u0000+$/g,""),hardwareId:f.toString().replace(/\u0000+$/g,""),type:l[0]})}},this.isParametersDirty=function(){return e.VBVMR_IsParametersDirty()},this.parameters=(n=this,{Command:{Shutdown:function(t){return u(n,"Command","Shutdown",t)},Show:function(t){return u(n,"Command","Show",t)},Restart:function(t){return u(n,"Command","Restart",t)},Eject:function(t){return u(n,"Command","Eject",t)},Reset:function(t){return u(n,"Command","Reset",t)},Save:function(t){return u(n,"Command","Save",t)},Load:function(t){return u(n,"Command","Load",t)},Lock:function(t){return u(n,"Command","Lock",t)},Button:function(t){return{State:function(e){return u(n,"Command","Button["+t+"]","State",e)},StateOnly:function(e){return u(n,"Command","Button["+t+"]","StateOnly",e)},Trigger:function(e){return u(n,"Command","Button["+t+"]","Trigger",e)},Color:function(e){return u(n,"Command","Button["+t+"]","Color",e)}}},DialogShow:{VBANCHAT:function(t){return u(n,"Command","DialogShow","VBANCHAT",t)}},SaveBUSEQ:function(t){return function(e){return u(n,"Command","SaveBUSEQ["+t+"]",e)}},LoadBUSEQ:function(t){return function(e){return u(n,"Command","LoadBUSEQ["+t+"]",e)}},SaveStripEQ:function(t){return function(e){return u(n,"Command","SaveStripEQ["+t+"]",e)}},LoadStripEQ:function(t){return function(e){return u(n,"Command","LoadStripEQ["+t+"]",e)}},Preset:function(t){return{Recall:function(e){return u(n,"Command","Preset["+t+"]","Recall",e)}}}},Strip:function(t){return{Mono:function(e){return u(n,"Strip["+t+"]","Mono",e)},Mute:function(e){return u(n,"Strip["+t+"]","Mute",e)},Solo:function(e){return u(n,"Strip["+t+"]","Solo",e)},MC:function(e){return u(n,"Strip["+t+"]","MC",e)},Gain:function(e){return u(n,"Strip["+t+"]","Gain",e)},GainLayer:function(e){return function(r){return u(n,"Strip["+t+"]","GainLayer["+e+"]",r)}},Pan_x:function(e){return u(n,"Strip["+t+"]","Pan_x",e)},Pan_y:function(e){return u(n,"Strip["+t+"]","Pan_y",e)},Color_x:function(e){return u(n,"Strip["+t+"]","Color_x",e)},Color_y:function(e){return u(n,"Strip["+t+"]","Color_y",e)},fx_x:function(e){return u(n,"Strip["+t+"]","fx_x",e)},fx_y:function(e){return u(n,"Strip["+t+"]","fx_y",e)},Audibility:function(e){return u(n,"Strip["+t+"]","Audibility",e)},Comp:{GainIn:function(e){return u(n,"Strip["+t+"]","Comp","GainIn",e)},Ratio:function(e){return u(n,"Strip["+t+"]","Comp","Ratio",e)},Threshold:function(e){return u(n,"Strip["+t+"]","Comp","Threshold",e)},Attack:function(e){return u(n,"Strip["+t+"]","Comp","Attack",e)},Release:function(e){return u(n,"Strip["+t+"]","Comp","Release",e)},Knee:function(e){return u(n,"Strip["+t+"]","Comp","Knee",e)},GainOut:function(e){return u(n,"Strip["+t+"]","Comp","GainOut",e)},MakeUp:function(e){return u(n,"Strip["+t+"]","Comp","MakeUp",e)}},Gate:{Threshold:function(e){return u(n,"Strip["+t+"]","Gate","Threshold",e)},Damping:function(e){return u(n,"Strip["+t+"]","Gate","Damping",e)},BPSidechain:function(e){return u(n,"Strip["+t+"]","Gate","BPSidechain",e)},Attack:function(e){return u(n,"Strip["+t+"]","Gate","Attack",e)},Hold:function(e){return u(n,"Strip["+t+"]","Gate","Hold",e)},Release:function(e){return u(n,"Strip["+t+"]","Gate","Release",e)}},Denoiser:{Threshold:function(e){return u(n,"Strip["+t+"]","Denoiser","Threshold",e)}},Pitch:{On:function(e){return u(n,"Strip["+t+"]","Pitch","On",e)},DryWet:function(e){return u(n,"Strip["+t+"]","Pitch","DryWet",e)},PitchValue:function(e){return u(n,"Strip["+t+"]","Pitch","PitchValue",e)},LoFormant:function(e){return u(n,"Strip["+t+"]","Pitch","LoFormant",e)},MedFormant:function(e){return u(n,"Strip["+t+"]","Pitch","MedFormant",e)},HiFormant:function(e){return u(n,"Strip["+t+"]","Pitch","HiFormant",e)}},Karaoke:function(e){return u(n,"Strip["+t+"]","Karaoke",e)},Limit:function(e){return u(n,"Strip["+t+"]","Limit",e)},EQGain1:function(e){return u(n,"Strip["+t+"]","EQGain1",e)},EQGain2:function(e){return u(n,"Strip["+t+"]","EQGain2",e)},EQGain3:function(e){return u(n,"Strip["+t+"]","EQGain3",e)},Label:function(e){return u(n,"Strip["+t+"]","Label",e)},A1:function(e){return u(n,"Strip["+t+"]","A1",e)},A2:function(e){return u(n,"Strip["+t+"]","A2",e)},A3:function(e){return u(n,"Strip["+t+"]","A3",e)},A4:function(e){return u(n,"Strip["+t+"]","A4",e)},A5:function(e){return u(n,"Strip["+t+"]","A5",e)},B1:function(e){return u(n,"Strip["+t+"]","B1",e)},B2:function(e){return u(n,"Strip["+t+"]","B2",e)},B3:function(e){return u(n,"Strip["+t+"]","B3",e)},FadeTo:function(e){return u(n,"Strip["+t+"]","FadeTo",e)},FadeBy:function(e){return u(n,"Strip["+t+"]","FadeBy",e)},Reverb:function(e){return u(n,"Strip["+t+"]","Reverb",e)},Delay:function(e){return u(n,"Strip["+t+"]","Delay",e)},Fx1:function(e){return u(n,"Strip["+t+"]","Fx1",e)},Fx2:function(e){return u(n,"Strip["+t+"]","Fx2",e)},PostReverb:function(e){return u(n,"Strip["+t+"]","PostReverb",e)},PostDelay:function(e){return u(n,"Strip["+t+"]","PostDelay",e)},PostFx1:function(e){return u(n,"Strip["+t+"]","PostFx1",e)},PostFx2:function(e){return u(n,"Strip["+t+"]","PostFx2",e)},EQ:{on:function(e){return u(n,"Strip["+t+"]","EQ","on",e)},AB:function(e){return u(n,"Strip["+t+"]","EQ","AB",e)},channel:function(e){return{cell:function(r){return{on:function(o){return u(n,"Strip["+t+"]","EQ","channel["+e+"]","cell["+r+"]","on",o)},type:function(o){return u(n,"Strip["+t+"]","EQ","channel["+e+"]","cell["+r+"]","type",o)},f:function(o){return u(n,"Strip["+t+"]","EQ","channel["+e+"]","cell["+r+"]","f",o)},gain:function(o){return u(n,"Strip["+t+"]","EQ","channel["+e+"]","cell["+r+"]","gain",o)},q:function(o){return u(n,"Strip["+t+"]","EQ","channel["+e+"]","cell["+r+"]","q",o)}}}}}},VAIO:function(e){return u(n,"Strip["+t+"]","VAIO",e)},App:function(e){return{Gain:function(r){return u(n,"Strip["+t+"]","App["+e+"]","Gain",r)},Mute:function(r){return u(n,"Strip["+t+"]","App["+e+"]","Mute",r)}}},AppGain:function(e){return u(n,"Strip["+t+"]","AppGain",e)},AppMute:function(e){return u(n,"Strip["+t+"]","AppMute",e)},device:{name:function(e){return u(n,"Strip["+t+"]","device","name",e)},sr:function(e){return u(n,"Strip["+t+"]","device","sr",e)},wdm:function(e){return u(n,"Strip["+t+"]","device","wdm",e)},ks:function(e){return u(n,"Strip["+t+"]","device","ks",e)},mme:function(e){return u(n,"Strip["+t+"]","device","mme",e)},asio:function(e){return u(n,"Strip["+t+"]","device","asio",e)}}}},Bus:function(t){return{Mono:function(e){return u(n,"Bus["+t+"]","Mono",e)},Mute:function(e){return u(n,"Bus["+t+"]","Mute",e)},EQ:{on:function(e){return u(n,"Bus["+t+"]","EQ","on",e)},AB:function(e){return u(n,"Bus["+t+"]","EQ","AB",e)},channel:function(e){return{cell:function(r){return{on:function(o){return u(n,"Bus["+t+"]","EQ","channel["+e+"]","cell["+r+"]","on",o)},type:function(o){return u(n,"Bus["+t+"]","EQ","channel["+e+"]","cell["+r+"]","type",o)},f:function(o){return u(n,"Bus["+t+"]","EQ","channel["+e+"]","cell["+r+"]","f",o)},gain:function(o){return u(n,"Bus["+t+"]","EQ","channel["+e+"]","cell["+r+"]","gain",o)},q:function(o){return u(n,"Bus["+t+"]","EQ","channel["+e+"]","cell["+r+"]","q",o)}}}}}},Gain:function(e){return u(n,"Bus["+t+"]","Gain",e)},Label:function(e){return u(n,"Bus["+t+"]","Label",e)},mode:{normal:function(e){return u(n,"Bus["+t+"]","mode","normal",e)},Amix:function(e){return u(n,"Bus["+t+"]","mode","Amix",e)},Bmix:function(e){return u(n,"Bus["+t+"]","mode","Bmix",e)},Repeat:function(e){return u(n,"Bus["+t+"]","mode","Repeat",e)},Composite:function(e){return u(n,"Bus["+t+"]","mode","Composite",e)},TVMix:function(e){return u(n,"Bus["+t+"]","mode","TVMix",e)},UpMix21:function(e){return u(n,"Bus["+t+"]","mode","UpMix21",e)},UpMix41:function(e){return u(n,"Bus["+t+"]","mode","UpMix41",e)},UpMix61:function(e){return u(n,"Bus["+t+"]","mode","UpMix61",e)},CenterOnly:function(e){return u(n,"Bus["+t+"]","mode","CenterOnly",e)},LFEOnly:function(e){return u(n,"Bus["+t+"]","mode","LFEOnly",e)},RearOnly:function(e){return u(n,"Bus["+t+"]","mode","RearOnly",e)}},FadeTo:function(e){return u(n,"Bus["+t+"]","FadeTo",e)},FadeBy:function(e){return u(n,"Bus["+t+"]","FadeBy",e)},Sel:function(e){return u(n,"Bus["+t+"]","Sel",e)},ReturnReverb:function(e){return u(n,"Bus["+t+"]","ReturnReverb",e)},ReturnDelay:function(e){return u(n,"Bus["+t+"]","ReturnDelay",e)},ReturnFx1:function(e){return u(n,"Bus["+t+"]","ReturnFx1",e)},ReturnFx2:function(e){return u(n,"Bus["+t+"]","ReturnFx2",e)},Monitor:function(e){return u(n,"Bus["+t+"]","Monitor",e)},VAIO:function(e){return u(n,"Bus["+t+"]","VAIO",e)},device:{name:function(e){return u(n,"Bus["+t+"]","device","name",e)},sr:function(e){return u(n,"Bus["+t+"]","device","sr",e)},wdm:function(e){return u(n,"Bus["+t+"]","device","wdm",e)},ks:function(e){return u(n,"Bus["+t+"]","device","ks",e)},mme:function(e){return u(n,"Bus["+t+"]","device","mme",e)},asio:function(e){return u(n,"Bus["+t+"]","device","asio",e)}}}},Fx:{Reverb:{On:function(t){return u(n,"Fx","Reverb","On",t)},AB:function(t){return u(n,"Fx","Reverb","AB",t)}},Delay:{On:function(t){return u(n,"Fx","Delay","On",t)},AB:function(t){return u(n,"Fx","Delay","AB",t)}}},patch:{asio:function(t){return function(e){return u(n,"patch","asio["+t+"]",e)}},OutA2:function(t){return function(e){return u(n,"patch","OutA2["+t+"]",e)}},OutA3:function(t){return function(e){return u(n,"patch","OutA3["+t+"]",e)}},OutA4:function(t){return function(e){return u(n,"patch","OutA4["+t+"]",e)}},OutA5:function(t){return function(e){return u(n,"patch","OutA5["+t+"]",e)}},composite:function(t){return function(e){return u(n,"Patch","composite["+t+"]",e)}},insert:function(t){return function(e){return u(n,"Patch","insert["+t+"]",e)}},PostFaderComposite:function(t){return u(n,"Patch","PostFaderComposite",t)},PostFxInsert:function(t){return u(n,"Patch","PostFxInsert",t)}},Option:{sr:function(t){return u(n,"Option","sr",t)},ASIOsr:function(t){return u(n,"Option","ASIOsr",t)},delay:function(t){return function(e){return u(n,"Option","delay["+t+"]",e)}},buffer:{mme:function(t){return u(n,"Option","buffer","mme",t)},wdm:function(t){return u(n,"Option","buffer","wdm",t)},ks:function(t){return u(n,"Option","buffer","ks",t)},asio:function(t){return u(n,"Option","buffer","asio",t)}},mode:{exclusif:function(t){return u(n,"Option","mode","exclusif",t)},swift:function(t){return u(n,"Option","mode","swift",t)}},MonitorOnSEL:function(t){return u(n,"Option","MonitorOnSEL",t)},SliderMode:function(t){return u(n,"Option","SliderMode",t)}},recorder:{stop:function(t){return u(n,"recorder","stop",t)},play:function(t){return u(n,"recorder","play",t)},replay:function(t){return u(n,"recorder","replay",t)},ff:function(t){return u(n,"recorder","ff",t)},rew:function(t){return u(n,"recorder","rew",t)},A1:function(t){return u(n,"recorder","A1",t)},A2:function(t){return u(n,"recorder","A2",t)},A3:function(t){return u(n,"recorder","A3",t)},A4:function(t){return u(n,"recorder","A4",t)},A5:function(t){return u(n,"recorder","A5",t)},B1:function(t){return u(n,"recorder","B1",t)},B2:function(t){return u(n,"recorder","B2",t)},B3:function(t){return u(n,"recorder","B3",t)},record:function(t){return u(n,"recorder","record",t)},pause:function(t){return u(n,"recorder","pause",t)},goto:function(t){return u(n,"Recorder","goto",t)},load:function(t){return u(n,"Recorder","load",t)},samplerate:function(t){return u(n,"Recorder","samplerate",t)},ArmStrip:function(t){return function(e){return u(n,"Recorder","ArmStrip("+t+")",e)}},ArmBus:function(t){return function(e){return u(n,"Recorder","ArmBus("+t+")",e)}},mode:{recbus:function(t){return u(n,"Recorder","mode","recbus",t)},PlayOnLoad:function(t){return u(n,"Recorder","mode","PlayOnLoad",t)},Loop:function(t){return u(n,"Recorder","mode","Loop",t)},MultiTrack:function(t){return u(n,"Recorder","mode","MultiTrack",t)}},bitResolution:function(t){return u(n,"Recorder","bitResolution",t)},Channel:function(t){return u(n,"Recorder","Channel",t)},kbps:function(t){return u(n,"Recorder","kbps",t)},FileType:function(t){return u(n,"Recorder","FileType",t)},gain:function(t){return u(n,"Recorder","gain",t)}},vban:{Enable:function(t){return u(n,"vban","Enable",t)},instream:function(t){return{on:function(e){return u(n,"vban","instream["+t+"]","on",e)},name:function(e){return u(n,"vban","instream["+t+"]","name",e)},ip:function(e){return u(n,"vban","instream["+t+"]","ip",e)},port:function(e){return u(n,"vban","instream["+t+"]","port",e)},sr:function(e){return u(n,"vban","instream["+t+"]","sr",e)},channel:function(e){return u(n,"vban","instream["+t+"]","channel",e)},bit:function(e){return u(n,"vban","instream["+t+"]","bit",e)},quality:function(e){return u(n,"vban","instream["+t+"]","quality",e)},route:function(e){return u(n,"vban","instream["+t+"]","route",e)}}},outstream:function(t){return{on:function(e){return u(n,"vban","outstream["+t+"]","on",e)},name:function(e){return u(n,"vban","outstream["+t+"]","name",e)},ip:function(e){return u(n,"vban","outstream["+t+"]","ip",e)},port:function(e){return u(n,"vban","outstream["+t+"]","port",e)},sr:function(e){return u(n,"vban","outstream["+t+"]","sr",e)},channel:function(e){return u(n,"vban","outstream["+t+"]","channel",e)},bit:function(e){return u(n,"vban","outstream["+t+"]","bit",e)},quality:function(e){return u(n,"vban","outstream["+t+"]","quality",e)},route:function(e){return u(n,"vban","outstream["+t+"]","route",e)}}}}}),this.attachChangeEvent=function(n){t.eventPool.push(n)},this.getOption=function(n){if(!t.isConnected)throw new Error("Not correct connected ");if(t.stringParameters.some(function(t){return n.includes(t)})){var r=Buffer.alloc(512);return e.VBVMR_GetParameterStringA(n,r),String.fromCharCode.apply(null,r).split("").filter(function(n){return"\0"!==n}).join("")}var u=[0];return e.VBVMR_GetParameterFloat(n,u),u[0]},this.setOption=function(n){var t=Buffer.alloc(n.length+1);return t.fill(0).write(n),e.VBVMR_SetParameters(t),new Promise(function(n){return setTimeout(n,200)})},this.checkPropertyChange=function(){1===t.isParametersDirty()&&t.eventPool.forEach(function(n){n()})},this.getVoicemeeterType=function(){var n=[0];if(0!==e.VBVMR_GetVoicemeeterType(n))throw new Error("running failed");switch(n[0]){case 1:return"voicemeeter";case 2:return"voicemeeterBanana";case 3:return"voicemeeterPotato";default:throw new Error("Voicemeeter seems not to be installed")}},this.getVoicemeeterVersion=function(){var n=[0];if(0!==e.VBVMR_GetVoicemeeterVersion(n))throw new Error("running failed");return((4278190080&n[0])>>24)+"."+((16711680&n[0])>>16)+"."+((65280&n[0])>>8)+"."+(255&n[0])},this.getLevel=function(n,t){var r=[0];return e.VBVMR_GetLevel(n,t,r),r[0]}}var i;return o.init=function(){try{return Promise.resolve(function(){try{var n=new t({hive:t.HKLM,key:"\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\VB:Voicemeeter {17359A74-1236-5467}"});return Promise.resolve(new Promise(function(t){n.values(function(n,e){if(n)throw new Error(n);var r=e.find(function(n){return"UninstallString"===n.name}).value,u=r.lastIndexOf("\\");t(r.slice(0,u))})}))}catch(n){return Promise.reject(n)}}()).then(function(t){return new Promise(function(u){r||(r=new o);var i=n.load(t+"/VoicemeeterRemote64.dll");e={VBVMR_Login:i.func("long __stdcall VBVMR_Login(void)"),VBVMR_Logout:i.func("long __stdcall VBVMR_Logout(void)"),VBVMR_RunVoicemeeter:i.func("long __stdcall VBVMR_RunVoicemeeter(long mode)"),VBVMR_IsParametersDirty:i.func("long __stdcall VBVMR_IsParametersDirty(void)"),VBVMR_GetLevel:i.func("long __stdcall VBVMR_GetLevel(long type, long channel, _Out_ float* value)"),VBVMR_GetParameterFloat:i.func("long __stdcall VBVMR_GetParameterFloat(const char* param, _Out_ float* value)"),VBVMR_GetParameterStringA:i.func("long __stdcall VBVMR_GetParameterStringA(const char* param, _Out_ char* value)"),VBVMR_SetParameters:i.func("long __stdcall VBVMR_SetParameters(const char* param)"),VBVMR_Output_GetDeviceNumber:i.func("long __stdcall VBVMR_Output_GetDeviceNumber(void)"),VBVMR_Output_GetDeviceDescA:i.func("long __stdcall VBVMR_Output_GetDeviceDescA(long index, _Out_ long* type, _Out_ char* name, _Out_ char* hardwareId)"),VBVMR_Input_GetDeviceNumber:i.func("long __stdcall VBVMR_Input_GetDeviceNumber(void)"),VBVMR_Input_GetDeviceDescA:i.func("long __stdcall VBVMR_Input_GetDeviceDescA(long index, long* type, char* name, char* hardwareId)"),VBVMR_GetVoicemeeterType:i.func("long __stdcall VBVMR_GetVoicemeeterType(_Out_ long* type)"),VBVMR_GetVoicemeeterVersion:i.func("long __stdcall VBVMR_GetVoicemeeterVersion(_Out_ long* version)")},r.isInitialised=!0,u(r)})})}catch(n){return Promise.reject(n)}},(i=[{key:"$outputDevices",get:function(){return this.outputDevices}},{key:"$inputDevices",get:function(){return this.inputDevices}},{key:"$version",get:function(){return this.version}},{key:"$type",get:function(){return this.type}}])&&function(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}(o.prototype,i),o}(),c={__proto__:null};export{i as Voicemeeter,c as types};
//# sourceMappingURL=index.module.js.map
